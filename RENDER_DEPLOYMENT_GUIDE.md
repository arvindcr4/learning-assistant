# Render.com Deployment Guide for Learning Assistant

This comprehensive guide walks you through deploying the Learning Assistant Next.js application on Render.com with PostgreSQL database, Redis cache, and production-ready configuration.

## üöÄ Quick Start (5 minutes)

For a quick deployment, follow these steps:

1. **Fork/Clone Repository**
2. **Create Render Account** at [render.com](https://render.com)
3. **Deploy using render.yaml** (recommended)
4. **Configure environment variables**
5. **Test deployment**

## üìã Prerequisites

- GitHub account with access to your Learning Assistant repository
- Render.com account (free tier available)
- Basic understanding of environment variables
- PostgreSQL knowledge (helpful but not required)

## üèóÔ∏è Architecture Overview

The deployment includes:
- **Web Service**: Next.js application on Node.js 20
- **PostgreSQL Database**: Primary data storage
- **Redis Cache**: Session and performance caching
- **Static Assets**: CDN-optimized static files
- **Health Checks**: Automated monitoring
- **Auto-scaling**: Based on traffic

## üìù Step-by-Step Deployment

### Step 1: Prepare Your Repository

1. **Ensure all files are in your repository:**
   ```bash
   git add .
   git commit -m "Add Render deployment configuration"
   git push origin main
   ```

2. **Verify required files exist:**
   - `render.yaml` - Main configuration
   - `Dockerfile.render` - Optimized Docker build
   - `.env.render.template` - Environment variables template
   - `render-build.sh` - Build script
   - `render-start.sh` - Startup script

### Step 2: Create Render Account

1. Go to [render.com](https://render.com)
2. Sign up using GitHub (recommended)
3. Connect your GitHub account
4. Grant access to your repository

### Step 3: Deploy Services

#### Option A: Using render.yaml (Recommended)

1. **Create New Service**
   - Click "New +" ‚Üí "Blueprint"
   - Connect your repository
   - Select the repository containing your Learning Assistant code
   - Render will automatically detect `render.yaml`

2. **Review Configuration**
   - Service name: `learning-assistant`
   - Region: `oregon` (or closest to your users)
   - Plan: `starter` (upgrade to `standard` for production)

3. **Deploy**
   - Click "Apply"
   - Render will create all services automatically:
     - Web service
     - PostgreSQL database
     - Redis cache

#### Option B: Manual Setup

If you prefer manual setup:

1. **Create PostgreSQL Database**
   - Click "New +" ‚Üí "PostgreSQL"
   - Database name: `learning-assistant-db`
   - Database name: `learning_assistant`
   - User: `learning_assistant_user`
   - Plan: `starter`
   - Region: `oregon`

2. **Create Redis Cache**
   - Click "New +" ‚Üí "Redis"
   - Name: `learning-assistant-redis`
   - Plan: `starter`
   - Region: `oregon`

3. **Create Web Service**
   - Click "New +" ‚Üí "Web Service"
   - Connect repository
   - Runtime: `Docker`
   - Dockerfile path: `./Dockerfile.render`
   - Plan: `starter`
   - Region: `oregon`

### Step 4: Configure Environment Variables

Set these in the Render dashboard for your web service:

#### Required Variables (Auto-generated by render.yaml)
```env
NODE_ENV=production
PORT=3000
NEXT_TELEMETRY_DISABLED=1
```

#### Database Variables (Auto-populated)
```env
DATABASE_URL=postgresql://...
DB_HOST=<auto-populated>
DB_PORT=5432
DB_NAME=learning_assistant
DB_USER=learning_assistant_user
DB_PASSWORD=<auto-generated>
DB_SSL=true
```

#### Redis Variables (Auto-populated)
```env
REDIS_URL=redis://...
REDIS_HOST=<auto-populated>
REDIS_PORT=6379
REDIS_PASSWORD=<auto-generated>
```

#### Security Variables (Generate these)
```env
BETTER_AUTH_SECRET=<generate-strong-secret>
SESSION_SECRET=<generate-strong-secret>
ENCRYPTION_KEY=<generate-strong-secret>
```

#### API Keys (Set manually)
```env
OPENAI_API_KEY=<your-openai-api-key>
SMTP_USER=<your-email>
SMTP_PASSWORD=<your-email-password>
```

### Step 5: Configure Custom Domain (Optional)

1. **Add Custom Domain**
   - Go to your web service settings
   - Click "Custom Domains"
   - Add your domain (e.g., `app.yourdomain.com`)

2. **Configure DNS**
   - Add CNAME record: `app.yourdomain.com` ‚Üí `your-service.onrender.com`
   - Wait for DNS propagation (5-60 minutes)

3. **SSL Certificate**
   - Render automatically provisions SSL certificates
   - HTTPS is enforced by default

### Step 6: Test Deployment

1. **Check Service Status**
   ```bash
   curl https://your-app.onrender.com/api/health
   ```

2. **Expected Response**
   ```json
   {
     "status": "healthy",
     "timestamp": "2024-01-15T10:30:00.000Z",
     "version": "1.0.0",
     "uptime": 123,
     "checks": {
       "database": { "status": "healthy" },
       "redis": { "status": "healthy" },
       "logger": { "status": "healthy" }
     }
   }
   ```

3. **Test Application Features**
   - Browse to your application URL
   - Test user registration/login
   - Verify learning features work
   - Check analytics and recommendations

## üîß Configuration Options

### Service Plans

| Plan | CPU | Memory | Storage | Price |
|------|-----|--------|---------|-------|
| Starter | 0.5 CPU | 512MB | 1GB | $7/month |
| Standard | 1 CPU | 2GB | 10GB | $25/month |
| Pro | 2 CPU | 4GB | 20GB | $85/month |

### Database Plans

| Plan | Storage | Connections | Backups | Price |
|------|---------|-------------|---------|-------|
| Starter | 1GB | 20 | 7 days | $7/month |
| Standard | 10GB | 100 | 30 days | $25/month |
| Pro | 100GB | 500 | 90 days | $90/month |

### Redis Plans

| Plan | Memory | Connections | Persistence | Price |
|------|--------|-------------|-------------|-------|
| Starter | 25MB | 20 | Optional | $7/month |
| Standard | 1GB | 100 | Yes | $25/month |
| Pro | 5GB | 500 | Yes | $90/month |

## üîí Security Configuration

### SSL/TLS
- Automatic SSL certificate provisioning
- HTTPS enforced by default
- TLS 1.2+ support

### Security Headers
```yaml
headers:
  - key: "X-Frame-Options"
    value: "DENY"
  - key: "X-Content-Type-Options"
    value: "nosniff"
  - key: "Referrer-Policy"
    value: "strict-origin-when-cross-origin"
  - key: "Strict-Transport-Security"
    value: "max-age=31536000; includeSubDomains"
```

### Environment Variable Security
- Never commit secrets to git
- Use Render's secret management
- Rotate secrets regularly

## üìä Monitoring & Logging

### Built-in Monitoring
- CPU and memory usage
- Request metrics
- Error tracking
- Performance monitoring

### Health Checks
- **Endpoint**: `/api/health`
- **Interval**: 30 seconds
- **Timeout**: 10 seconds
- **Retry**: 3 attempts

### Logging
- Application logs via console
- Access logs automatically captured
- Log retention: 7 days (starter), 30 days (standard+)

### Custom Metrics
```javascript
// Add to your application
const { register, collectDefaultMetrics } = require('prom-client');
collectDefaultMetrics();

// Custom metrics endpoint
app.get('/metrics', (req, res) => {
  res.set('Content-Type', register.contentType);
  res.end(register.metrics());
});
```

## üöÄ Performance Optimization

### Caching Strategy
- Redis for session data
- Static asset caching (24 hours)
- Database query caching (30 minutes)

### Build Optimization
- Multi-stage Docker build
- Tree-shaking enabled
- Compression enabled
- Static asset optimization

### Database Optimization
- Connection pooling (max 10 connections)
- Query optimization
- Indexing strategy
- Read replicas (pro plan)

## üîÑ Auto-Scaling

### Horizontal Scaling
```yaml
services:
  - type: web
    numInstances: 2  # Run 2 instances
    scaling:
      minInstances: 1
      maxInstances: 5
      targetCPU: 70
      targetMemory: 80
```

### Vertical Scaling
- Upgrade service plan as needed
- Monitor resource usage
- Set up alerts for high usage

## üìà Deployment Workflow

### Automatic Deployment
1. Push to `main` branch
2. Render detects changes
3. Builds Docker image
4. Runs tests (if configured)
5. Deploys to production
6. Runs health checks

### Manual Deployment
1. Go to Render dashboard
2. Click "Manual Deploy"
3. Select branch/commit
4. Monitor deployment progress

### Rollback Strategy
1. Go to deployment history
2. Select previous successful deployment
3. Click "Redeploy"
4. Monitor rollback progress

## üêõ Troubleshooting

### Common Issues

#### Build Failures
```bash
# Check build logs
# Common causes:
# - Missing dependencies
# - TypeScript errors
# - Environment variables

# Solutions:
npm install --save-dev @types/node
npm run type-check
```

#### Database Connection Issues
```bash
# Check database status
# Verify environment variables
# Test connection manually

# Solutions:
# - Check DATABASE_URL format
# - Verify database is running
# - Check network connectivity
```

#### Memory Issues
```bash
# Monitor memory usage
# Check for memory leaks
# Optimize queries

# Solutions:
# - Upgrade service plan
# - Implement pagination
# - Add caching
```

### Debug Commands
```bash
# Check service logs
render logs learning-assistant

# Check database logs
render logs learning-assistant-db

# Check Redis logs
render logs learning-assistant-redis

# Test health endpoint
curl -v https://your-app.onrender.com/api/health
```

## üîÑ Backup & Recovery

### Database Backups
- Automatic daily backups
- Retention: 7 days (starter), 30 days (standard+)
- Manual backup creation available

### Restore Process
1. Go to database dashboard
2. Select backup to restore
3. Choose restore target
4. Confirm restoration

### Disaster Recovery
- Multi-region deployment (pro plan)
- Database replication
- Automated failover

## üì± Mobile Optimization

### Progressive Web App (PWA)
- Service worker enabled
- Offline functionality
- App-like experience

### Performance
- Image optimization
- Lazy loading
- Mobile-first responsive design

## üåê Internationalization

### Supported Languages
- English (en)
- Spanish (es)
- French (fr)
- German (de)
- Japanese (ja)
- Arabic (ar)

### Configuration
```env
DEFAULT_LOCALE=en
SUPPORTED_LOCALES=en,es,fr,de,ja,ar
```

## üìû Support & Resources

### Render Support
- Documentation: [render.com/docs](https://render.com/docs)
- Community: [community.render.com](https://community.render.com)
- Support: [render.com/support](https://render.com/support)

### Learning Assistant Support
- GitHub Issues: Create issues for bugs
- Documentation: Check project README
- Community: Join discussions

## üéØ Next Steps

After successful deployment:

1. **Configure monitoring alerts**
2. **Set up CI/CD pipeline**
3. **Configure backup strategy**
4. **Implement logging strategy**
5. **Set up error tracking**
6. **Configure analytics**
7. **Plan scaling strategy**

## üìã Checklist

### Pre-Deployment
- [ ] Code committed to repository
- [ ] Environment variables configured
- [ ] Database schema ready
- [ ] Docker build tested locally
- [ ] Health checks implemented

### Post-Deployment
- [ ] Health endpoint responding
- [ ] Database connectivity verified
- [ ] Redis cache working
- [ ] Application features tested
- [ ] Performance metrics checked
- [ ] Monitoring configured
- [ ] Backup strategy implemented

### Production Readiness
- [ ] Custom domain configured
- [ ] SSL certificate active
- [ ] Security headers implemented
- [ ] Performance optimized
- [ ] Monitoring alerts configured
- [ ] Backup verification
- [ ] Disaster recovery plan

## üéâ Success!

Your Learning Assistant is now deployed on Render.com with:
- ‚úÖ Production-ready Next.js application
- ‚úÖ PostgreSQL database with automatic backups
- ‚úÖ Redis cache for performance
- ‚úÖ Automatic SSL certificates
- ‚úÖ Health monitoring
- ‚úÖ Auto-scaling capabilities
- ‚úÖ Security best practices

Your application is now live and ready for users!

---

*For additional help, consult the [Render documentation](https://render.com/docs) or create an issue in the project repository.*